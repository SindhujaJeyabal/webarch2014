<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Responsive Mobile</title>
		<!-- two css files are used-->
		<link href="responsive.css" rel="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.2.min.js"></script>
	</head>

	<body>
		<div class="bg"> 
			<!-- <div class="contentwrapper"> -->
			<div class="header">
				<h1 text-align:'center'> Welcome to 2D-Rubix! </h1>
				<h2 text-align:'center'> Make all boxes in a column to have the same color</h2>
				<h3 id='tip_text'> </h3>
			</div>
			<div class="wrapper">
				<div class="column" id="col1">
					<div name='box' id="r1c1"></div>
					<div name='box' id="r2c1"></div>
					<div name='box' id="r3c1"></div>
		    	</div>

				<div class="column" id="col2">
					<div name='box' id="r1c2"></div>
					<div name='box' id="r2c2"></div>
					<div name='box' id="r3c2"></div>
				</div>

				<div class="column" id="col3">
					<div name='box' id="r1c3"></div>
					<div name='box' id="r2c3"></div>
					<div name='box' id="r3c3"></div>
				</div>
			</div>
		</div>

		<script>
			//global variables
			// var colorData = ['#AA00EE', '#00AAEE', '#EEAA00'];
			var colorData = ['red', 'blue', 'green'];
			var rowColData = ['r1c1', 'r1c2', 'r1c3', 'r2c1', 'r2c2', 'r2c3', 'r3c1', 'r3c2', 'r3c3'];
			var target_div = undefined;

			//randome number generator for box colors
			function makeRandomList()
			{
				randArr = [];
				for(var i = 0; i < 9; i++)
					randArr[randArr.length] = Math.floor((Math.random() * 3));	
			}
			//Draw the layout
			function makeLayout()
			{
				makeRandomList();
				canvasCounter = 0;
				for(i = 0; i < window.randArr.length; i++)
				{
					document.getElementById(window.rowColData[canvasCounter]).style.backgroundColor = window.colorData[window.randArr[i]];
					canvasCounter++;
				}
			}

			//Check for win			
			function checkEachColumn(indexArray)
			{
				base_color = document.getElementById(window.rowColData[indexArray[0]]).style.backgroundColor;
				mismatch = 0;
				for(i = 1; i < indexArray.length; i++)
				{
					box_div = document.getElementById(window.rowColData[indexArray[i]]);
					if(box_div.style.backgroundColor === base_color)
						continue;
					mismatch = 1; break;
				}
				if(!mismatch)
					return true;
				return false;
			}
			function haveYouWon()
			{
				if(checkEachColumn([0,3,6]) & checkEachColumn([1,4,7]) & checkEachColumn([2,5,8]))
					alert('You Have Won!');
			}
			//Assign touch events
			function assignEvents()
			{
				var boxList = document.getElementsByName("box");
				console.log(boxList[0]);
				for(i = 0; i < boxList.length; i++)
				{
					boxList[i].addEventListener("touchend", function(ev){
						console.log('touch end');
						color_val = target_div.style.backgroundColor;
						console.log(color_val, window.colorData.indexOf(color_val));
						target_div.style.backgroundColor = window.colorData[(window.colorData.indexOf(color_val)+1)%3];
						haveYouWon();
					}, false);

					boxList[i].addEventListener("touchstart", function(ev){
						// console.log('touchstart');
						target_div = ev.touches.item(ev.touches.length-1).target;
					}, false);

					boxList[i].addEventListener("touchmove", function(ev){
						// console.log('touchmove');
						target_div = ev.touches.item(ev.touches.length-1).target;
					}, false);
				}
			}

			//On Document Ready
			function doInitialSetup()
			{
				makeLayout();
				assignEvents();
			}
			$(document).ready(doInitialSetup);
	    </script>
	</body>
</html>